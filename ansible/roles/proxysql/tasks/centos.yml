- name: Add Mysql repository
  yum: name=http://dev.mysql.com/get/mysql57-community-release-el7-11.noarch.rpm
  tags: [mysql]

- name: Install proxysql RPM dependencies
  become: true
  yum: name={{ item }} state=present
  with_items:
    - glib2-devel
    - openssl-devel
    - mysql-community-client
    - perl-DBD-MySQL
  tags: [proxysql]

- name: Install proxysql RPM 
  become: true
  shell: rpm -ivh https://github.com/sysown/proxysql/releases/download/v1.4.1/proxysql-1.4.1-1-centos7.x86_64.rpm
  tags: [proxysql]

- name: Copy proxysql.cnf file
  template: 
    src: proxysql.cnf.j2 
    dest: /etc/proxysql.cnf
    owner: root 
    group: root 
    mode: 0644
  tags: [proxysql]